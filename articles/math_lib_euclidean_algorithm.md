---
title: "math.gcd ã®æ­£ä½“ã¯ä½•ãªã®ã‹"
emoji: "ğŸº"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [python3, algorithm, æœ€å¤§å…¬ç´„æ•°, ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰äº’åŠ©æ³•]
published: false
---

> ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆè‡ªç§°ï¼‰vol.11

çš†ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ã€‚yumyum116 ã§ã™ã€‚SWEè»¢è·ã‚’ç›®æŒ‡ã™è€…ã§ã™ã€‚
ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ä¾¿ä¹—ã—ã¦ã€1æ—¥1è¨˜äº‹æŠ•ç¨¿ã«æŒ‘æˆ¦ã™ã‚‹ã¨ã¨ã‚‚ã«ã€åŸ·ç­†æ´»å‹•ã®ç¿’æ…£åŒ–ã«ã‚‚æŒ‘æˆ¦ã—ã¦ã¿ã¾ã™ã€‚

ã“ã®è¨˜äº‹ã¯ã€`ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä»•æ§˜ãŒæ°—ã«ãªã£ã¦èª¿ã¹ã¦ã¿ãŸ`ã‚·ãƒªãƒ¼ã‚ºã§ã™ã€‚
ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åˆå­¦è€…ã®æ–¹ã®å‚è€ƒã«ãªã‚Œã°å¬‰ã—ã„ã§ã™ã€‚

ä»Šå›ã¯ã€python ã® math ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ä½¿ç”¨å¯èƒ½ãª gcd ã«ã¤ã„ã¦å–ã‚Šä¸Šã’ã¾ã™ã€‚

## 1. gcd ã®æ­£ä½“ã¯ä½•ãªã®ã‹
å…ˆæ—¥ã€ã“ã¡ã‚‰ã®è¨˜äº‹ã§æœ€å¤§å…¬ç´„æ•°ãƒ»æœ€å°å…¬å€æ•°ã‚’æ±‚ã‚ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ”¯ãˆã‚‹é«˜æ ¡æ•°å­¦ã«ã¤ã„ã¦è¨€åŠã—ã¾ã—ãŸã€‚

https://zenn.dev/yumyum116/articles/math_hs_gcd_lcm

ä¸Šè¨˜ã®è¨˜äº‹ã§ã¯ã€æ•´æ•°ã®æ€§è³ªã‚’åˆ©ç”¨ã—ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ã”ç´¹ä»‹ã—ã¾ã—ãŸãŒã€æœãŸã—ã¦ python ã® math ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ä½¿ç”¨å¯èƒ½ãªé–¢æ•° gcd ã‚‚åŒã˜ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã‹ãŒæ°—ã«ãªã£ãŸãŸã‚ã€ä»Šå›å–ã‚Šæ‰±ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚

çµè«–ã‚’å…ˆã«æ›¸ãã¨ã€math.gcd ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ **ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•** ã¨å‘¼ã°ã‚Œã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚
èª¿ã¹ã¦ã¿ãŸã¨ã“ã‚ã€ã“ã¡ã‚‰ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯é«˜æ ¡æ•°å­¦ã®ä¸­ã§ã¯å—é¨“æ•°å­¦ã®æ–‡è„ˆã§å­¦ã¶ã‚ˆã†ã§ã™ã­ã€‚
ç§ã‚‚å­¦ã‚“ã ã“ã¨ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å½“ç„¶ã®ã“ã¨ãªãŒã‚‰ã™ã£ã‹ã‚Šå¿˜ã‚Œã¦ã„ã¾ã™ã€‚


å¾©ç¿’ã‚‚å…¼ã­ã¦ã€æœ¬è¨˜äº‹ã§èª¬æ˜ã—ã¦ã¿ã¾ã™ã€‚

## 2. ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’ç†è§£ã™ã‚‹
ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã¯ã€ï¼’ã¤ã®è‡ªç„¶æ•°ã®é–“ã«æˆã‚Šç«‹ã¤æ¬¡ã®é‡è¦ãªå®šç†ã‚’ç”¨ã„ã¦ã€ï¼’ã¤ã®è‡ªç„¶æ•°ã®æœ€å¤§å…¬ç´„æ•°ã‚’æ±‚ã‚ã‚‹æ–¹æ³•ã§ã™ã€‚

> é‡è¦ãªå®šç†
2ã¤ã®è‡ªç„¶æ•° $a$, $b$ ã«ã¤ã„ã¦ã€$a$ ã‚’ $b$ ã§å‰²ã£ãŸã¨ãã®å•†ã‚’ $q$, ä½™ã‚Šã‚’ $r$ ã¨ã™ã‚‹ã¨ã€
**ã€Œ $a$ ã¨ $b$ ã®æœ€å¤§å…¬ç´„æ•°ã€ã¯ã€ã€Œ $b$ ã¨ $r$ ã®æœ€å¤§å…¬ç´„æ•°ã€ã«ç­‰ã—ã„ã€‚**

ã“ã®æ€§è³ªã‚’ç”¨ã„ã¦ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’èª¬æ˜ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#### ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•
ï¼’ã¤ã®è‡ªç„¶æ•° $a$, $b$ ã®æœ€å¤§å…¬ç´„æ•°ã¯æ¬¡ã®ã‚ˆã†ã«æ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚

1. $a$ ã‚’ $b$ ã§å‰²ã‚Šã€ä½™ã‚Š $r$ ã‚’æ±‚ã‚ã‚‹
2. $b$ ã‚’ 1 ã§æ±‚ã‚ãŸä½™ã‚Š $r$ ã§å‰²ã‚Šã€ãã®ä½™ã‚Š $r_1$ ã‚’æ±‚ã‚ã‚‹
3. $r$ ã‚’ 2 ã§æ±‚ã‚ãŸä½™ã‚Š $r_1$ ã§å‰²ã‚Šã€ãã®ä½™ã‚Š $r_2$ ã‚’æ±‚ã‚ã‚‹
...
4. 2~3 ã®æ“ä½œã‚’ç¹°ã‚Šè¿”ã™ã¨ã€ä½™ã‚ŠãŒå¿…ãš $0$ ã«ãªã‚‹ã€‚ä½™ã‚ŠãŒ $0$ ã«ãªã£ãŸã¨ãã®å‰²ã‚‹æ•°ãŒã€æ±‚ã‚ã‚‹æœ€å¤§å…¬ç´„æ•°ã«ãªã‚‹


å…·ä½“çš„ãªä¾‹ã‚’ç”¨ã„ã¦ã€ç¢ºã‹ã‚ã¦ã¿ã¾ã™ã€‚

ã“ã“ã§ã¯ã€645 ã¨ 412 ã®æœ€å¤§å…¬ç´„æ•°ã‚’ã€ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã§æ±‚ã‚ã¦ã¿ã¾ã™ã€‚

$$
1. 645 / 412 = 1 ... 234 \\
2. 412 / 234 = 1 ... 178 \\
3. 234 / 178 = 1 ... 56 \\
4. 178 /  56 = 3 ... 0 \\
$$

ã—ãŸãŒã£ã¦ã€645 ã¨ 412 ã®æœ€å¤§å…¬ç´„æ•°ã¯ 56 ã¨ãªã‚Šã¾ã™ã€‚


ã•ã¦ã€ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã«ã‚ˆã‚‹æœ€å¤§å…¬ç´„æ•°ã®æ±‚ã‚æ–¹ãŒåˆ†ã‹ã£ãŸã¨ã“ã‚ã§ã€ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’è¨¼æ˜ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

#### ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã®è¨¼æ˜
ç´™å¹…ã®ç¯€ç´„ã®ãŸã‚ã€ä»¥ä¸‹ã§ã¯ã€ï¼’ã¤ã®è‡ªç„¶æ•° $a$, $b$ ã®æœ€å¤§å…¬ç´„æ•°ã‚’ $gcd(a, b)$ ã¨è¡¨è¨˜ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚
ã“ã®è¡¨è¨˜ã‚’ç”¨ã„ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã¯æ¬¡ã®ã‚ˆã†ã«è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

$$
gcd(a, b) = gcd(b, r)
$$

$a$ ã‚’ $b$ ã§å‰²ã£ãŸå•†ã‚’ $q$, ä½™ã‚Šã‚’ $r$ ã¨ãŠãã¨

$$
a = bq + rã€€		ï½¥ï½¥ï½¥(i)
$$

ã¨è¡¨ã›ã‚‹ã€‚

(i) ã‚’å¤‰å½¢ã™ã‚‹ã¨ã€

$$
r = a - bq			ï½¥ï½¥ï½¥(ii)
$$

ã¨ãªã‚‹ã€‚ã“ã“ã§ã€$a$, $b$ ã¯ $gcd(a, b)$ ã®å€æ•°ã§ã‚ã‚‹ãŸã‚ã€ã€€(ii) ã‚‚ $gcd(a, b)$ ã®å€æ•°ã«ãªã‚‹ã€‚ã—ãŸãŒã£ã¦ã€$gcd(a, b)$ ã¯ $b$ ã¨ $r$ ã®å…¬ç´„æ•°ã§ã‚ã‚‹ã€‚æœ€å¤§å…¬ç´„æ•°ã¯ã€å…¬ç´„æ•°ã®ä¸­ã§æœ€å¤§ã¨ãªã‚‹æ•°ã§ã‚ã‚‹ã®ã§ã€

$$
gcd(b, r) >= gcd(a, b)		ï½¥ï½¥ï½¥(iii)
$$

ãŒæˆã‚Šç«‹ã¤ã€‚

ã¾ãŸã€$b$, $r$ ã¯ $gcd(b, r)$ ã®å€æ•°ãªã®ã§ã€(i) ã‚‚ $gcd(b, r)$ ã®å€æ•°ã«ãªã‚‹ã€‚ã—ãŸãŒã£ã¦ã€$gcd(b, r)$ ã¯ $a$ ã¨ $b$ ã®å…¬ç´„æ•°ã§ã‚ã‚‹ã€‚æœ€å¤§å…¬ç´„æ•°ã¯ã€å…¬ç´„æ•°ã®ä¸­ã§æœ€å¤§ã¨ãªã‚‹æ•°ã§ã‚ã‚‹ã®ã§ã€

$$
gcd(a, b) >= gcd(b, r)		ï½¥ï½¥ï½¥(iv)
$$

ãŒæˆã‚Šç«‹ã¤ã€‚

(iii), (iv) ã‚ˆã‚Šã€

$$
gcd(a, b) = gcd(b, r)
$$

ä»¥ä¸Šã§è¨¼æ˜ã¯çµ‚ã‚ã‚Šã§ã™ã€‚

## 3. ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’å®Ÿè£…ã™ã‚‹
ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã¯ã€ä¸€èˆ¬ã«æ¬¡ã®ã‚ˆã†ã«å®Ÿè£…ã§ãã¾ã™ã€‚

```js:calculate_gcd_euclidean.py
def calculate_gcd_euclidean(a, b):
	if b == 0:
		return a

	return calculate_gcd_euclidean(b, a%b)
```

ã•ã¦ã€python ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã©ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚
å…ˆã«æ–­ã£ã¦ãŠãã¾ã™ãŒã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰ã¯ Cè¨€èªã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

```math_gcd.c
+math_gcd(PyObject *self, PyObject *args)
+{
+	PyObject *a, *b, *c;
+	long x, y, t;
+
+	if (!PyArg_UnpackTuple(args, "gcd", 2, 2, &a, &b))
+		return NULL;
+	if (PyInt_Check(a)) {
+		x = PyInt_AS_LONG(a);
+		if (PyInt_Check(b)) {
+			/* both a and b are integers;
+			   use the usual gcd algorithm */
+			y = PyInt_AS_LONG(b);
+			while (y != 0) {
+				t = x%y;
+				x = y;
+				y = t;
+			}
+			if (x < 0) {
+				/* need to take abs value; check whether -x overflows */
+				if ((unsigned long)(x) == 0-(unsigned long)(x)) {
+					PyObject *o = PyLong_FromLong(x);
+					if (o == NULL)
+						return NULL;
+					PyObject *result = PyNumber_Negative(o);
+					Py_DECREF(o);
+					return result;
+				}
+				else {
+					return PyInt_FromLong(-x);
+				}
+			}
+			else {
+				return PyInt_FromLong(x);
+			}
+		}
+		else if (PyLong_Check(b)) {
+			a = PyLong_FromLong(x);
+			c = (PyObject *)_PyLong_GCD((PyLongObject *)a, (PyLongObject *)b);
+			Py_DECREF(a);
+			return c;
+		}
+		else {
+			PyErr_SetString(PyExc_TypeError, "expected an integer");
+			return NULL;
+		}
+	}
+	else if (PyLong_Check(a)) {
+		if (PyInt_Check(b)) {
+			b = PyLong_FromLong(PyInt_AS_LONG(b));
+			c = (PyObject *)_PyLong_GCD((PyLongObject *)a, (PyLongObject *)b);
+			Py_DECREF(b);
+			return c;
+		}
+		else if (PyLong_Check(b)) {
+			c = (PyObject *)_PyLong_GCD((PyLongObject *)a, (PyLongObject *)b);
+			return c;
+		}
+		else {
+			PyErr_SetString(PyExc_TypeError, "expected an integer");
+			return NULL;
+		}
+	}
+	else {
+		PyErr_SetString(PyExc_TypeError, "expected an integer");
+		return NULL;
+	}
+}
```
[source](https://bugs.python.org/file9486/lehmer_gcd.patch)

å®Ÿè£…ãŒé•·ã„ã®ã¯ã€å›ºå®šé•·æ•´æ•° (int, long)ã®åˆ‡ã‚Šæ›¿ãˆã‚„ã€ä»»æ„ç²¾åº¦æ•´æ•°ã®å ´åˆã®å‡¦ç†ãªã©ã€å¼•æ•°ã«æ¸¡ã•ã‚ŒãŸæ•´æ•°ã®å¤§ãã•ï¼ˆé•·ã• â‰’ ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ä¸–ç•Œã«ãŠã„ã¦ã¯æ¶ˆè²»ã™ã‚‹ãƒ¡ãƒ¢ãƒªã®å¤§ãã•ï¼‰ã«å¿œã˜ãŸå‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

pythonã«ãŠã„ã¦ã¯ã€ã™ã¹ã¦ã®æ•´æ•°ã¯ä»»æ„ã®é•·ã•ã‚’ã‚‚ã¤ `long` æ•´æ•°ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¾ã™ã€‚ï¼ˆ[å‚è€ƒ](https://docs.python.org/ja/3.14/c-api/long.html)ï¼‰
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒ `PyTypeObject` ã®å ´åˆã¯ã€`int` ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚

ã•ã¦ã€ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã«è©²å½“ã™ã‚‹éƒ¨åˆ†ã¯ä»¥ä¸‹ã§ã™ã€‚

```
	while (y != 0) {
		t = x % y;
		x = y;
		y = t;
	}
```

å†å¸°ã®è¡¨ç¾ã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€æœ¬å®¶ã§ã‚‚éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã§ã—ãŸã€‚

ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ä»¥å¤–ã®ä»»æ„ç²¾åº¦æ•´æ•°ã®å‡¦ç†å‘¨ã‚Šã®å®Ÿè£…ã«ã¤ã„ã¦ã¯ã€python ã®ä»•æ§˜ãªç´°ã‹ã„ç†è§£ãŒå¿…è¦ã«ãªã‚‹ãŸã‚ã€æœ¬è¨˜äº‹ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚
æ°—ã«ãªã‚‹æ–¹ã¯èª¿ã¹ã¦ã¿ã¦ãã ã•ã„ã€‚

-----

è¨˜äº‹å†…ã«èª¤è¬¬ç­‰ã‚ã‚‹å ´åˆã«ã¯ã€ä¿®æ­£ã„ãŸã—ã¾ã™ã€‚ãã®éš›ã¯ã€ã”é€£çµ¡ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

ãã‚Œã§ã¯ã€ã¾ãŸã€‚
