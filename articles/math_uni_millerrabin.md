---
title: "Miller-Rabin 法を理解する"
emoji: "🐺"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [python3, algorithm, miller-rabin, ミラーラビン素数判定法]
published: false
---

> アドベントカレンダー（自称）vol.18

皆さん、こんにちは。yumyum116 です。SWE転職を目指す者です。
アドベントカレンダーに便乗して、1日1記事投稿に挑戦するとともに、執筆活動の習慣化にも挑戦してみます。

先日、「素数判定を行うプログラムのアルゴリズム間の実行時間の違い」を調査するためのテストケース考案の裏話に関する記事を公開しました。

https://zenn.dev/yumyum116/articles/algorithm_testcase_optimization

実行時間差テストの中では、検証対象プログラムで実装しているアルゴリズムの時間計算量をベースに、8桁の数値をテストケースとして選定し、当初 chatGPT が提案した40桁の数値は、プログラムに実装しているアルゴリズムでは TLE になるという理由で、テストケースから除外しました。

しかし、テストケースの数値が40桁であっても、十分に現実的な時間でプログラムの実行が完了するアルゴリズムの一つとして、`Miller-Rabin法` を紹介しています。

本記事では、この `Miller-Rabin法` を取り上げます。

## 1. Miller-Rabin 法とは
与えられた整数が素数かどうかを判定するアルゴリズムの一種で、確率的アルゴリズムの一つです。
Miller-Rabin法を理解する上では、次の2つの素数の性質の理解が欠かせません。

### 素数の性質１

$$
a, b, c, ... を整数とし、p を素数とする。
abc... が p の倍数であるならば、a, b, c, ...のうちの少なくとも１つは p の倍数である。
$$

本定理の証明については、[『初等整数論講義』](https://amzn.to/4jo0BsR)を参照ください。本記事では割愛します。

### 素数の性質２：Fermat の小定理

$p$ が素数とし、$a$ を $p$ で割り切れない整数とする。このとき、

$$
a^{p-1} \equiv 1\>(mod\> p)
$$

が成立する。

具体的な値を当てはめて説明すると、

$$
4^6 \equiv (-3)^6\> (mod\> 7)    ...①
$$

について、これは、**$4$ と $3$ が法 $7$ において、同じ剰余類（合同）であることを使って、底を置き換えている**ことを表します。

「法」とは、**ある数で割ったときの余りに着目する際の基準となる数（割る数）**を指し、主に合同式（モジュロ演算）の文脈で使われる概念です。
式①は、「$7$ を法として、$4$ と $-3$ は合同である」と読みます。$4$ や $-3$ が底に当たります。

続いて、**合同である**ことについて理解しましょう。

$$
4 \equiv (-3)\> (mod\> 7)    ...②
$$

について、

$$
4 - (-3) = 7
$$

となり、$7$ で割り切れる差をもつため、**$4$ と $-3$ は $mod7$では同じ数として扱える**ことを意味します。

また、合同の基本性質として、

$$
a \equiv b (mod\> m) ⇛\> a^k \equiv b^k\> (mod\> m)
$$

が成り立ちます。

この性質により、式②の両辺を６乗して

$$
4^6 \equiv (-3)^6\> (mod\> 7)
$$

となります。

具体例を用いて、Fermat の定理を理解してみます。

$p = 11$ とすると

+ $1^{10} = 1 \equiv 1\>(mod\> 11)$
+ $2^{10} = 1024 \equiv 1\>(mod\> 11)$
+ $3^{10} = 59049 \equiv 1\>(mod\> 11)$
+ $4^{10} \equiv (-3)^{10}\> = 3^{10}\> \equiv 1\>(mod\> 11)$
+ $5^{10} \equiv (-2)^{10}\> = 2^{10}\> \equiv 1\>(mod\> 11)$
+ $6^{10} \equiv (-1)^{10}\> = 1^{10}\> \equiv 1\>(mod\> 11)$

が成り立ちます。

素数の性質１と同様、本定理の証明は、本記事では割愛します。

## 2.
